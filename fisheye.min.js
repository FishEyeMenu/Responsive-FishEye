/**
 * fisheye.js
 *
 * A JavaScript micro-framework for adding fisheye functionality
 * to elements for advanced UI development.
 *
 * @author     Neil Oman
 * @version    1
 * @copyright  Copyright 2016 Neil Oman
 * @license    Dual licensed under MIT and GPL
 */
fisheye=function(){this.cacheob={},this.obj=!1,this.obj_left=0,this.im=[],this.nfish=0,this.sensitive=100,this.imsp=[],this.ciw1=0,this.ciw2=0,this.ciw3=0,this.ciw4=0,this.rt=0,this.nmb=-1,this.oxpos=-1,this.running=0,this.locations=[],this.axis=1,this.ar=[],this.createVert=function(i,s){this.axis=0,this.create(i,s)},this.create=function(i,s){this.obj=this.ob(i),this.obj.fishy=this,this.im=this.obj.getElementsByClassName("fisheye"),this.nfish=this.im.length,this.sensitive=s?s:100,this.imsp=this.obj.getElementsByClassName("fishspace")
for(var t=0;t<this.nfish;++t)this.im[t].i=t
var h=this
this.obj.onresize=function(){h.resize()},this.obj.onmousemove=function(i){var s=1==this.fishy.axis?(i?i.pageX:window.event.x+document.body.scrollLeft-2)-this.fishy.obj_left:(i?i.pageY:window.event.y+document.body.scrollTop-2)-this.fishy.obj_left
this.fishy.ar=[s],this.fishy.sq()},this.obj.ontouchmove=function(i){var s=i.touches&&i.touches.length?i.touches:[i],t=i.changedTouches&&i.changedTouches[0]||s[0],h=1==this.fishy.axis?(t?t.pageX:window.event.x+document.body.scrollLeft-2)-this.fishy.obj_left:(t?t.pageY:window.event.y+document.body.scrollTop-2)-this.fishy.obj_left
this.fishy.ar=[h],this.fishy.sq()},this.obj.onmouseout=this.obj.ontouchend=function(){this.fishy.ss(this.fishy.nfish,0,1)},this.obj.onresize=function(){this.fishy.ss(this.nfish,0,1)},this.ss(this.nfish,0,1)},this.resize=function(){this.ss(this.nfish,0,1)},this.ss=function(i,s,t,h){s=1==this.axis?Math.floor(this.obj.offsetWidth/(this.nfish+2)):Math.floor(this.obj.offsetHeight/(this.nfish+2)),this.ciw=s,this.ciw1=.5*this.ciw,this.ciw2=2*this.ciw,this.ciw3=.74*this.ciw,this.ciw4=14*this.ciw,1==this.axis?(this.obj.style.height=this.ciw2+"px",this.imsp[0].style.height=this.imsp[0].style.width=this.imsp[1].style.height=this.imsp[1].style.width=this.ciw2+"px"):(this.obj.style.width=this.ciw2+"px",this.imsp[0].style.width=this.imsp[0].style.height=this.imsp[1].style.width=this.imsp[1].style.height=this.ciw2+"px"),this.rt=.01*this.ciw-1
for(var e=0;e<this.nfish;++e)this.locations[e]=this.rt++
this.rt=this.nfish
for(var o,n,c=0,e=1;e<this.nfish-1;++e)(o=this.im[e].style).width=o.height=s+"px",n=1==this.axis?o.marginTop=(this.ciw2-s)/2+"px":o.marginLeft=(this.ciw2-s)/2+"px",c+=s
var f=2*this.ciw*2+this.ciw*(this.nfish-2)
1==this.axis?(this.imsp[0].style.width=this.imsp[1].style.width=(f-c)/2+"px",this.obj_left=this.fPosXY(this.obj)[0]):(this.imsp[0].style.height=this.imsp[1].style.height=(f-c)/2+"px",this.obj_left=this.fPosXY(this.obj)[2])},this.sq=function(){var i=this
if(1==this.running)clearTimeout(this.nmb),this.nmb=setTimeout(i.sq,this.sensitive)
else{this.running=1,this.oxpos=this.xpos=this.ar.length>0?this.ar.shift():this.oxpos,this.x2pos=this.xpos
for(var s=Math.floor,t=Math.abs,h=Math.max,e=0,o=1;o<this.nfish-1;++o){var n=s(this.ciw1*h(0,2-t((1.2445*(this.xpos-this.ciw2)+this.ciw3)/this.ciw4*this.rt-this.locations[o]))+this.ciw),c=this.im[o].style
c.width=c.height=n+"px",1==this.axis?c.marginTop=(this.ciw2-n)/2+"px":c.marginLeft=(this.ciw2-n)/2+"px"
e+=n}var f=this.ciw*(this.nfish+2)
1==this.axis?this.imsp[0].style.width=this.imsp[1].style.width=(f-e)/2+"px":this.imsp[0].style.height=this.imsp[1].style.height=(f-e)/2+"px",this.running=0}this.ar.length>0&&(clearTimeout(this.nmb),this.nmb=setTimeout(sel.sq,i.sensitive))},this.obz=function(i,s){return"string"==typeof i?""===i?s:document.getElementById(i):i},this.ob=function(i){return"string"==typeof i?this.cacheob.hasOwnProperty(i)?this.cacheob[i]:this.cacheob[i]=this.obz(i):this.obz(i)},this.fPosXY=function(i){var s=this.ob(i).getBoundingClientRect()
return[s.left,s.right,s.top,s.bottom,s.left+(s.right-s.left)/2,s.top+(s.bottom-s.top)/2]}}
